#  Foodgram

## Описание

Foodgram - это проект, где пользователи могут поделиться друг с другом рецептами приготовления различных блюд. Функционал проекта позволяет зарегистрированным пользователям добавлять понравившиеся рецепты в избранное, подписываться на других пользователей, добавлять рецепты в корзину и скачивать

Данный проект является курсовым проектом платформы [Яндекс.Практикума](https://practicum.yandex.ru/) и представляет собой SPA приложение. Фротнэнд был предоставлен Яндекс Практимумом, бекэнд а также инструкции для `Docker` и `CI/CD` автоматизации написаны [Валентином Башкатовым](https://github.com/bashval).

Развернутый проект можно посмотреть по ссылке: https://cookbook.redirectme.net/

## Как развернуть проект

В проекте реализована возможность запуска двух версий: обычной и для продакшена. Обычрая версия подходит для разворачивания на локальной машине для отладки и тестирования, а также для написания новых "фич". Продакшн версия нужна для развертывании на удаленном продакшн-сервере, чтобы к ней обращались непосредственно юзеры. 

Для запуска локально используется файл `docker-compose.yml` - он написан так, что строит имиджи и запускает контейнеры из кода проекта находящегося непосредственно на самой локальной машине.  

`docker-compose.production.yml` используется для запуска продакшн версии и в нем имиджи для докера беруться из удаленного репозитория на DockerHub.

### Запуск локально

Для того, чтобы запустить проект локально, необходимо:

- На локальной машине клонировать репозиторий и перейти в него в командной строке:

```git clone https://github.com/bashval/foodgram.git```

```cd foodgram```

- В директории проекта создать файл переменных окружения `.env`. За основу можно взять файл `.env.example`. 

- Установить Docker Compose:
```Bash
sudo apt update
sudo apt install curl
curl -fSL https://get.docker.com -o get-docker.sh
sudo sh ./get-docker.sh
sudo apt install docker-compose-plugin
```

- Запустить Docker Compose используя файл `docker-compose.yml`:

```sudo docker compose -f docker-compose.yml up -d```

При запуску контейнеров настроено автоматическое выполние миграций, сбор и копирование статических файлов бэкенда. Также настроена автоматическая загрузка Ингредиентов и Тегов в базу данных из csv файлов.

Проект будет доступен после запуска контейнеров по адресу http://localhost:8000

### Запуск удаленно

Для запуска проекта на удаленном сервере:

- Подключитесь к удалённому серверу:
```Bash
ssh -i путь_до_файла_с_SSH_ключом/название_файла_с_SSH_ключом имя_пользователя@ip_адрес_сервера
```

- На удаленном сервере установите Docker Compose:
```Bash
sudo apt update
sudo apt install curl
curl -fSL https://get.docker.com -o get-docker.sh
sudo sh ./get-docker.sh
sudo apt install docker-compose-plugin
```

- Создайте директорию для проекта перейдите в неё:

```mkdir foodgram```

```cd foodgram```

- Скопируйте на сервер в директорию проекта файл docker-compose.production.yml:

```Bash
scp -i path_to_SSH/SSH_name docker-compose.production.yml \
    username@server_ip:/home/username/taski/docker-compose.production.yml
```

- В директории проекта создйте файл переменных окружения `.env`. За основу можно взять файл `.env.example`. Или, усли уже имеется готовый .env-файл, то можно скопировать его таким же способом, как в предыдущем шаге. 

- Запустите Docker Compose используя файл `docker-compose.production.yml`:

```sudo docker compose -f docker-compose.production.yml up -d```

При запуску контейнеров настроено автоматическое выполние миграций, сбор и копирование статических файлов бэкенда. Также настроена автоматическая загрузка Ингредиентов и Тегов в базу данных из csv файлов.

Проект будет доступен после запуска контейнеров по адресу http://<ip_адрес_сервера>:8000

Можно настроить дополнительный сервер nginx, чтобы он принимал запросы на необходимое доменное имя и перенаправлял их на nginx сервер в кортейнере.

## GitHub Action Workflow

К проекту подключена `CI/CD` инструкция от платформы GitHub Action

Инструкция запускается при команде `git push` в любую из веток проекта. В ходе выполнения инструкции запускаются автоматические тесты для фронтенда и бэкенда. Далее, если тесты прошли успешно и **только** если  `push` выполнен в ветку `main`, произойдет сбока Docker имеджей на основе залитого кода и загрузка собранных имеджей на удаленный репозиторий на DockerHub. В дальнейшем на осове данных имеджей производится автоматический разворот проекта на удаленном сервере для продакшна. 

## Авторы
Данный проект выполнялся в качестве курсового проекта "Python-разработчик+" [Яндекс.Практикума](https://practicum.yandex.ru/).  
Автор проекта: [Валентин Башкатов](https://github.com/bashval).

![Tech Used](https://github-readme-tech-stack.vercel.app/api/cards?title=Technologies+Used&align=center&titleAlign=center&fontSize=26&lineCount=1&bg=%23ffffff&badge=%23000000&border=%2307d72a&titleColor=%230501f5&line1=Python%2CPython%2C9cc4e8%3BGitHub+Action%2CGitHub+Action%2C0004ff%3BDocker%2CDocker%2C58a6ff%3BDjango%2CDjango%2C58a6ff%3B)
